% Secao 7: Sistema de Relatorios Multi-Formato
% Production-Ready Reporting

\section{Sistema de Relatorios Multi-Formato}
\label{sec:reports}

Esta secao apresenta o sistema de geracao de relatorios do DeepBridge, que transforma resultados de validacao em documentos production-ready em multiplos formatos (HTML interativo, HTML estatico, PDF, JSON). O sistema e template-driven, permitindo customizacao visual sem modificar codigo, critico para integracao em workflows corporativos.

% ========================================
% 7.1 Motivacao
% ========================================

\subsection{Motivacao}
\label{sec:reports:motivation}

Validacao de ML gera dezenas de metricas e visualizacoes que devem ser comunicadas a stakeholders com diferentes necessidades:
\begin{itemize}
    \item \textbf{Data Scientists}: Relatorios tecnicos com metricas detalhadas e graficos interativos
    \item \textbf{Compliance Teams}: Relatorios audit-ready com verificacao regulatoria e assinaturas
    \item \textbf{Executives}: Resumos executivos com high-level insights
    \item \textbf{Sistemas Automatizados}: Dados estruturados (JSON) para pipelines de CI/CD
\end{itemize}

Ferramentas existentes geram saidas fragmentadas (graficos separados, notebooks exportados, CSVs) que requerem consolidacao manual. DeepBridge automatiza geracao de relatorios profissionais com um unico comando.

% ========================================
% 7.2 Arquitetura do Sistema
% ========================================

\subsection{Arquitetura do Sistema}
\label{sec:reports:architecture}

O sistema de relatorios segue arquitetura de 3 camadas:

\subsubsection{Camada 1: Data Aggregation}

Coleta e estrutura resultados de todas as suites de validacao:

\begin{lstlisting}[language=Python, caption=Agregacao de resultados]
# Estrutura de resultados unificada
report_data = {
    'metadata': {
        'experiment_name': 'credit_model_v1.2',
        'timestamp': '2025-12-05T10:30:00Z',
        'dataset_info': {...},
        'model_info': {...}
    },
    'fairness': {
        'metrics': {...},
        'compliance': {...},
        'weakspots': [...]
    },
    'robustness': {...},
    'uncertainty': {...},
    'resilience': {...},
    'hyperparameters': {...},
    'summary': {
        'overall_status': 'PASS',
        'critical_issues': [],
        'warnings': [...]
    }
}
\end{lstlisting}

\subsubsection{Camada 2: Template Engine}

Utiliza Jinja2 para renderizar templates customizaveis:

\begin{lstlisting}[language=Python, caption=Geracao via templates]
from deepbridge.reports import ReportGenerator

# Configurar gerador
generator = ReportGenerator(
    template_dir='templates/',
    output_format='html_interactive'  # ou 'html_static', 'pdf', 'json'
)

# Gerar relatorio
generator.generate(
    data=report_data,
    template='corporate_template.html',  # Template customizado
    output_path='validation_report.html',
    theme='company_brand'                 # Tema com cores corporativas
)
\end{lstlisting}

\subsubsection{Camada 3: Multi-Format Rendering}

Renderiza em multiplos formatos a partir da mesma estrutura de dados:

\paragraph{HTML Interativo}
Visualizacoes Plotly com hover, zoom e drill-down:
\begin{lstlisting}[language=Python, caption=Relatorio HTML interativo]
exp.save_html(
    suites='all',                    # ou ['fairness', 'robustness']
    output_path='report.html',
    report_type='interactive',
    include_sections=[
        'executive_summary',
        'detailed_metrics',
        'visualizations',
        'recommendations'
    ]
)
\end{lstlisting}

\paragraph{HTML Estatico}
Graficos Matplotlib para impressao/arquivamento:
\begin{lstlisting}[language=Python, caption=Relatorio HTML estatico]
exp.save_html(
    suites='all',
    output_path='report_static.html',
    report_type='static',           # Graficos pre-renderizados
    dpi=300                         # Alta resolucao
)
\end{lstlisting}

\paragraph{PDF}
Relatorios formatados profissionalmente via WeasyPrint:
\begin{lstlisting}[language=Python, caption=Relatorio PDF]
exp.save_pdf(
    suites='all',
    output_path='audit_report.pdf',
    template='audit_ready',         # Template com formatacao formal
    include_signatures=True,        # Campos para assinaturas
    watermark='CONFIDENTIAL'
)
\end{lstlisting}

\paragraph{JSON}
Dados estruturados para integracao:
\begin{lstlisting}[language=Python, caption=Export JSON]
exp.save_json(
    output_path='results.json',
    indent=2,                       # Pretty-print
    include_metadata=True
)

# Integrar com pipeline
import json
results = json.load(open('results.json'))
if results['summary']['overall_status'] != 'PASS':
    raise ValueError("Validation failed - blocking deployment")
\end{lstlisting}

% ========================================
% 7.3 Templates Customizaveis
% ========================================

\subsection{Templates Customizaveis}
\label{sec:reports:templates}

DeepBridge prove templates built-in e suporta customizacao completa.

\subsubsection{Templates Built-in}

\begin{itemize}
    \item \textbf{default}: Template simples com todas as secoes
    \item \textbf{audit\_ready}: Formato profissional para auditorias (compliance sections, signatures)
    \item \textbf{executive}: Resumo executivo com high-level insights
    \item \textbf{technical}: Relatorio tecnico detalhado com todas as metricas
\end{itemize}

\subsubsection{Customizacao de Templates}

Templates Jinja2 permitem flexibilidade total:

\begin{lstlisting}[caption=Template customizado (template.html)]
<!DOCTYPE html>
<html>
<head>
    <title>{{ experiment.name }} - Validation Report</title>
    <style>
        /* CSS corporativo */
        :root {
            --primary-color: #003366;    /* Azul corporativo */
            --secondary-color: #FFD700;  /* Dourado */
        }
        body { font-family: 'Corporate Sans', Arial; }
        .header { background: var(--primary-color); }
    </style>
</head>
<body>
    <header class="header">
        <img src="company_logo.png" alt="Logo">
        <h1>{{ experiment.name }}</h1>
        <p>Generated: {{ metadata.timestamp }}</p>
    </header>

    <section id="executive-summary">
        <h2>Executive Summary</h2>
        <div class="status {{ summary.overall_status }}">
            Status: {{ summary.overall_status }}
        </div>
        <p>{{ summary.description }}</p>
    </section>

    {% for suite_name, results in suites.items() %}
    <section id="{{ suite_name }}">
        <h2>{{ suite_name | title }}</h2>
        {% include 'partials/' + suite_name + '.html' %}
    </section>
    {% endfor %}

    <footer>
        <p>Confidential - Company Name</p>
        <p>Report generated by DeepBridge v{{ version }}</p>
    </footer>
</body>
</html>
\end{lstlisting}

Uso:
\begin{lstlisting}[language=Python]
exp.save_html(
    output_path='corporate_report.html',
    template='templates/corporate_template.html',
    theme_vars={
        'primary_color': '#003366',
        'company_logo': 'assets/logo.png'
    }
)
\end{lstlisting}

% ========================================
% 7.4 Visualizacoes
% ========================================

\subsection{Visualizacoes}
\label{sec:reports:visualizations}

DeepBridge gera visualizacoes automaticas para cada suite:

\subsubsection{Fairness Visualizations}

\begin{itemize}
    \item \textbf{Disparate Impact Bar Chart}: Comparacao de DI entre grupos
    \item \textbf{Equal Opportunity Heatmap}: Matriz de TPR por grupo
    \item \textbf{Calibration Plot}: Accuracy vs. confidence
    \item \textbf{Weakspot Treemap}: Visualizacao hierarquica de weakspots
\end{itemize}

\subsubsection{Robustness Visualizations}

\begin{itemize}
    \item \textbf{Noise Sensitivity Curve}: Accuracy vs. noise level
    \item \textbf{Adversarial Success Rate}: Barras por tipo de ataque
    \item \textbf{Slice Performance Matrix}: Heatmap de accuracy por slice
\end{itemize}

\subsubsection{Uncertainty Visualizations}

\begin{itemize}
    \item \textbf{Reliability Diagram}: Calibration plot
    \item \textbf{Confidence Distribution}: Histograma de probabilidades preditas
    \item \textbf{Conformal Prediction Coverage}: Cobertura vs. nivel
\end{itemize}

\subsubsection{Resilience Visualizations}

\begin{itemize}
    \item \textbf{PSI Timeline}: Evolucao de PSI ao longo do tempo
    \item \textbf{Feature Drift Heatmap}: PSI por feature
    \item \textbf{Drift Detection Alerts}: Timeline de alertas
\end{itemize}

Todas as visualizacoes sao geradas automaticamente e incluidas nos relatorios.

% ========================================
% 7.5 Integracao com Branding Corporativo
% ========================================

\subsection{Integracao com Branding Corporativo}
\label{sec:reports:branding}

DeepBridge facilita customizacao visual para match com identidade corporativa:

\begin{lstlisting}[language=Python, caption=Configuracao de branding]
from deepbridge.reports import BrandingConfig

# Definir branding corporativo
branding = BrandingConfig(
    company_name='Acme Corp',
    logo_path='assets/acme_logo.png',
    primary_color='#003366',
    secondary_color='#FFD700',
    font_family='Roboto',
    footer_text='Confidential - Acme Corp 2025'
)

# Aplicar em todos os relatorios
generator = ReportGenerator(branding=branding)
generator.generate(data=report_data, output_path='report.pdf')
\end{lstlisting}

\paragraph{Elementos Customizaveis}
\begin{itemize}
    \item Logo corporativo (header/footer)
    \item Paleta de cores (graficos e UI)
    \item Tipografia
    \item Watermarks (e.g., "CONFIDENTIAL")
    \item Footers com informacoes legais
    \item Secoes customizadas (e.g., disclaimers)
\end{itemize}

% ========================================
% 7.6 Sumario
% ========================================

\subsection{Sumario}
\label{sec:reports:summary}

O sistema de relatorios do DeepBridge oferece:

\begin{enumerate}
    \item \textbf{Multi-Formato}: HTML (interativo/estatico), PDF, JSON
    \item \textbf{Template-Driven}: Customizacao sem modificar codigo
    \item \textbf{Production-Ready}: Relatorios profissionais com branding corporativo
    \item \textbf{Automatizado}: Geracao com um unico comando
    \item \textbf{Completo}: Inclui metricas, visualizacoes, compliance, recomendacoes
\end{enumerate}

Este sistema reduz tempo de geracao de relatorios de horas (consolidacao manual) para minutos (automatizado), e garante consistencia e profissionalismo em todos os outputs.

A proxima secao (Secao~\ref{sec:implementation}) detalha aspectos de implementacao, otimizacoes de performance e padroes de design que permitem escalabilidade do DeepBridge para datasets grandes e pipelines de producao.
